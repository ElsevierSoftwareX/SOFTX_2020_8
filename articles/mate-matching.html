<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mate matching • dymium</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mate matching">
<meta property="og:description" content="">
<meta property="og:image" content="http://main.dymium.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dymium</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Use cases
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/residential-mobility.html">Residential mobility</a>
    </li>
    <li>
      <a href="../articles/mate-matching.html">Mate matching</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dymium-org/dymium">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Mate matching</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dymium-org/dymium/blob/master/vignettes/mate-matching.Rmd"><code>vignettes/mate-matching.Rmd</code></a></small>
      <div class="hidden name"><code>mate-matching.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># To install a package use `install.packages('package-name')`</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dymium)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; + dymiumCore 0.0.10      Date: 2019-12-02</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt;                                   R: 3.6.1</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt;                                  OS: Ubuntu 16.04.6 LTS</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;                                 GUI: X11</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt;                                </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(data.table)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(R6)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; The following objects are masked from 'package:data.table':</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt;     between, first, last</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(gganimate)</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt; Attaching package: 'gganimate'</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt; The following object is masked from 'package:dymiumCore':</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="co">#&gt;     Transition</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">728</span>)</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/assign.html">set</a></span>(<span class="dt">echo =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="load-population" class="section level2">
<h2 class="hasAnchor">
<a href="#load-population" class="anchor"></a>Load population</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Import individual and household data</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">ind_data &lt;-<span class="st"> </span>toy_individuals</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># Create an Individual object with attribute data</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">Ind &lt;-<span class="st"> </span>Individual<span class="op">$</span><span class="kw">new</span>(<span class="dt">.data =</span> ind_data, <span class="dt">id_col =</span> <span class="st">"pid"</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># show data</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">Ind<span class="op">$</span><span class="kw">get_data</span>()</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;      pid hid age    sex marital_status partner_id father_id mother_id</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;   1:   1   1  71   male  never married         NA        NA        NA</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt;   2:   2   2  31 female  never married         NA        NA        NA</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt;   3:   3   2  29 female  never married         NA        NA        NA</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt;   4:   4   3  38   male        married          5        NA        NA</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt;   5:   5   3  25 female        married          4        NA        NA</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt;  ---                                                                 </span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; 369: 369 143  73   male        married        368        NA        NA</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; 370: 370 144  49 female        married        371        NA        NA</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; 371: 371 144  59   male        married        370        NA        NA</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; 372: 372 144  15   male  never married         NA       371       370</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; 373: 373 144  17   male  never married         NA       371       370</span></a></code></pre></div>
</div>
<div id="randomly-assign-group-to-agents" class="section level2">
<h2 class="hasAnchor">
<a href="#randomly-assign-group-to-agents" class="anchor"></a>Randomly assign group to agents</h2>
<p>All agents will be randomly assigned a group number to them this is to create sub markets. Sub markets are defined such that only agents within the same sub market can interact with each other. This maybe used to mimic agents’ social network, geographical boundary, etc.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">n_groups &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co"># randomly assign group numbers to all agents</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">Ind<span class="op">$</span><span class="kw">get_data</span>(<span class="dt">copy =</span> <span class="ot">FALSE</span>)[, group <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Group_"</span>, <span class="dv">1</span><span class="op">:</span>n_groups), <span class="dt">size =</span> .N, <span class="dt">replace =</span> <span class="ot">TRUE</span>)]</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">Ind<span class="op">$</span><span class="kw">get_data</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> ., <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> age, <span class="dt">fill =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(group <span class="op">~</span><span class="st"> </span>sex) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">    </span>ggthemes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ggthemes/man/scale_few.html">scale_fill_few</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">    </span>ggthemes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span>(<span class="dt">base_size =</span> <span class="dv">12</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">title =</span> <span class="st">"Distribution of age by gender and group."</span>)</a></code></pre></div>
<p><img src="mate-matching_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
</div>
<div id="implement-matching-markets" class="section level2">
<h2 class="hasAnchor">
<a href="#implement-matching-markets" class="anchor"></a>Implement matching markets</h2>
<p>New matching market can be extended from the available matching market classes which are <code>MatchingMarketStochastic</code> and <code>MatchingMarketOptimal</code>. In every matching problems there are two sides of the market, we call them A and B. Scoring functions need to be defined for each side of the market manually by implementing <code>matching_score_A</code> and <code>matching_score_B</code>. <code>matching_score_A</code> represent how agents in one side of the market evaluate the candidates of the opposite side, and vice versa for <code>matching_score_B</code>. The user is expected to change the function but the three main argument for both the scoring functions must remain the same. <code>self$matching_problem</code> allows the function to access the variables given when the class was created.</p>
<p>The rule that all agents follow is simple, they want to find a match that has the least age difference, as expressed in the scoring functions <code>matching_score_A</code> and <code>matching_score_B</code>.</p>
<p><span class="math display">\[ MatchingScore_x = \frac{1}{1+|age_x - age_y|}\]</span></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(lattice)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; Loading required package: lattice</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">15</span>)  </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">y &lt;-<span class="st"> </span>x  </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">f &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) {</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  <span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(x<span class="op">-</span>y))</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">z &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(x, y, f)  </a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span>(z, <span class="dt">drape=</span>T, <span class="dt">col.regions=</span><span class="kw"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span>(<span class="dv">100</span>), <span class="dt">zlab =</span> <span class="st">"Score"</span>, <span class="dt">xlab =</span> <span class="st">"age_x"</span>, <span class="dt">y =</span> <span class="st">"age_y"</span>)</a></code></pre></div>
<p><img src="mate-matching_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">MateMatchingStochastic &lt;-<span class="st"> </span>R6<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="dt">classname =</span> <span class="st">"StochasticCohabitationMarket"</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">inherit =</span> MatchingMarketStochastic,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="dt">public =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="dt">matching_score_A =</span> <span class="cf">function</span>(<span class="dt">matching_problem =</span> self<span class="op">$</span>matching_problem,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                                idx_A,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">                                idx_B) {</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">      scores &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">        matching_problem<span class="op">$</span>agentset_A[[<span class="st">"age"</span>]][idx_A] <span class="op">-</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="st">          </span>matching_problem<span class="op">$</span>agentset_B[[<span class="st">"age"</span>]][idx_B]</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">      ))</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">    },</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">    <span class="dt">matching_score_B =</span> <span class="cf">function</span>(<span class="dt">matching_problem =</span> self<span class="op">$</span>matching_problem,</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">                                idx_B,</a>
<a class="sourceLine" id="cb6-15" data-line-number="15">                                idx_A) {</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">      scores &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">        matching_problem<span class="op">$</span>agentset_B[[<span class="st">"age"</span>]][idx_B] <span class="op">-</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="st">          </span>matching_problem<span class="op">$</span>agentset_A[[<span class="st">"age"</span>]][idx_A]</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">      ))</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">    }</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">  )</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">)</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">MateMatchingOptimal &lt;-<span class="st"> </span>R6<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="dt">classname =</span> <span class="st">"MateMatchingOptimal"</span>,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="dt">inherit =</span> MatchingMarketOptimal,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="dt">public =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="dt">matching_score_A =</span> <span class="cf">function</span>(<span class="dt">matching_problem =</span> self<span class="op">$</span>matching_problem, idx_A, idx_B) {</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">      <span class="kw"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="dt">X =</span> matching_problem<span class="op">$</span>agentset_B[[<span class="st">"age"</span>]][idx_B], <span class="co"># reviewers, rows</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">            <span class="dt">Y =</span> matching_problem<span class="op">$</span>agentset_A[[<span class="st">"age"</span>]][idx_A], <span class="co"># proposers, columns</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">            <span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">              <span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(x <span class="op">-</span><span class="st"> </span>y))</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">            })</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    },</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">    <span class="dt">matching_score_B =</span> <span class="cf">function</span>(<span class="dt">matching_problem =</span> self<span class="op">$</span>matching_problem, idx_B, idx_A) {</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">      <span class="kw"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="dt">X =</span> matching_problem<span class="op">$</span>agentset_A[[<span class="st">"age"</span>]][idx_A], <span class="co"># reviewers, rows</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">            <span class="dt">Y =</span> matching_problem<span class="op">$</span>agentset_B[[<span class="st">"age"</span>]][idx_B], <span class="co"># proposers, columns</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">            <span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">              <span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(x <span class="op">-</span><span class="st"> </span>y))</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">            })</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">    }</a>
<a class="sourceLine" id="cb7-19" data-line-number="19">  )</a>
<a class="sourceLine" id="cb7-20" data-line-number="20">)</a></code></pre></div>
</div>
<div id="simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># using dplyr's filter</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">agentset_A &lt;-<span class="st"> </span>Ind<span class="op">$</span><span class="kw">get_data</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(age <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>age <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span> <span class="op">&amp;</span><span class="st"> </span>sex <span class="op">==</span><span class="st"> 'male'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span>data.table<span class="op">::</span><span class="kw">setDT</span>(.) <span class="co"># convert back to data.table</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co"># using data.table syntax for filtering</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">agentset_B &lt;-<span class="st"> </span>Ind<span class="op">$</span><span class="kw">get_data</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st">  </span>.[age <span class="op">%between%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">20</span>, <span class="dv">60</span>) <span class="op">&amp;</span><span class="st"> </span>sex <span class="op">==</span><span class="st"> 'female'</span>]</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co"># define id column</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">id_col_A &lt;-<span class="st"> </span>id_col_B &lt;-<span class="st"> 'pid'</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co"># create a market object using its constructor</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14">StochasticMatching &lt;-<span class="st"> </span>MateMatchingStochastic<span class="op">$</span><span class="kw">new</span>(agentset_A, agentset_B, id_col_A, id_col_B, <span class="dt">grouping_vars =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'group'</span>))</a>
<a class="sourceLine" id="cb8-15" data-line-number="15"></a>
<a class="sourceLine" id="cb8-16" data-line-number="16">OptimalMatching &lt;-<span class="st"> </span>MateMatchingOptimal<span class="op">$</span><span class="kw">new</span>(agentset_A, agentset_B, id_col_A, id_col_B, <span class="dt">grouping_vars =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'group'</span>))</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">stochastic_matching_result &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span>StochasticMatching<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(<span class="dt">n_choices =</span> <span class="dv">10</span>, <span class="co"># number of potential partners each agent evaluates</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                              <span class="dt">method =</span> <span class="st">'pweighted'</span>, <span class="co"># weighted probability</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                              <span class="dt">by_group =</span> <span class="ot">TRUE</span>) <span class="co"># segments the whole population into by markets by their group</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; [22:12:05] INFO  dymiumCore self$split_market: The matching problem is splited into 2 groups (markets) with the total of 2 sub-markets</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">optimal_matching_result &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="st">  </span>OptimalMatching<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(<span class="dt">method =</span> <span class="st">"one-to-one"</span>, <span class="co"># each agent only has one match.</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">                           <span class="dt">one_sided =</span> <span class="ot">FALSE</span>, <span class="co"># agents from both sides of the market have preferences towards each other</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">                           <span class="dt">optimal_A =</span> <span class="ot">TRUE</span>, <span class="co"># optimal for A</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">                           <span class="dt">by_group =</span> <span class="ot">TRUE</span>) <span class="co"># segments the whole population into by markets by their group</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt; [22:12:05] INFO  dymiumCore self$split_market: The matching problem is splited into 2 groups (markets) with the total of 2 sub-markets</span></a></code></pre></div>
</div>
<div id="visualise-the-match-qualities-of-the-two-approaches-" class="section level2">
<h2 class="hasAnchor">
<a href="#visualise-the-match-qualities-of-the-two-approaches-" class="anchor"></a>Visualise the match qualities of the two approaches.</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">stochastic_matching_quality &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/na.omit.data.table.html">na.omit</a></span>(stochastic_matching_result) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="dt">x =</span> ., <span class="dt">y =</span> Ind<span class="op">$</span><span class="kw">get_data</span>()[, .(pid, age)], <span class="dt">by.x =</span> <span class="st">'id_A'</span>, <span class="dt">by.y =</span> <span class="st">'pid'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="dt">x =</span> ., <span class="dt">y =</span> Ind<span class="op">$</span><span class="kw">get_data</span>()[, .(pid, age)], <span class="dt">by.x =</span> <span class="st">'id_B'</span>, <span class="dt">by.y =</span> <span class="st">'pid'</span>, <span class="dt">suffixes =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'_A'</span>, <span class="st">'_B'</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span>.[, age_diff <span class="op">:</span><span class="er">=</span><span class="st"> </span>age_A <span class="op">-</span><span class="st"> </span>age_B]</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> stochastic_matching_quality, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(age_diff)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="dt">color =</span> <span class="st">"black"</span>, <span class="dt">fill =</span> <span class="st">"steelblue"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">title =</span> <span class="st">"A density plot of age differences in the stochastic mate matching market."</span>)</a></code></pre></div>
<p><img src="mate-matching_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">optimal_matching_quality &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/na.omit.data.table.html">na.omit</a></span>(optimal_matching_result) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="dt">x =</span> ., <span class="dt">y =</span> Ind<span class="op">$</span><span class="kw">get_data</span>()[, .(pid, age)], <span class="dt">by.x =</span> <span class="st">'id_A'</span>, <span class="dt">by.y =</span> <span class="st">'pid'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="dt">x =</span> ., <span class="dt">y =</span> Ind<span class="op">$</span><span class="kw">get_data</span>()[, .(pid, age)], <span class="dt">by.x =</span> <span class="st">'id_B'</span>, <span class="dt">by.y =</span> <span class="st">'pid'</span>, <span class="dt">suffixes =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'_A'</span>, <span class="st">'_B'</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span>.[, age_diff <span class="op">:</span><span class="er">=</span><span class="st"> </span>age_A <span class="op">-</span><span class="st"> </span>age_B]</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> optimal_matching_quality, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(age_diff)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="dt">color =</span> <span class="st">"black"</span>, <span class="dt">fill =</span> <span class="st">"salmon"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">title =</span> <span class="st">"A density plot of age differences in the optimal mate matching market."</span>)</a></code></pre></div>
<p><img src="mate-matching_files/figure-html/unnamed-chunk-10-2.png" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-population">Load population</a></li>
      <li><a href="#randomly-assign-group-to-agents">Randomly assign group to agents</a></li>
      <li><a href="#implement-matching-markets">Implement matching markets</a></li>
      <li><a href="#simulation">Simulation</a></li>
      <li><a href="#visualise-the-match-qualities-of-the-two-approaches-">Visualise the match qualities of the two approaches.</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Amarin Siripanich, Taha Rashidi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
