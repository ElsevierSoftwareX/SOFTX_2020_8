<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Residential mobility â€¢ dymium</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Residential mobility">
<meta property="og:description" content="">
<meta property="og:image" content="http://main.dymium.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dymium</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Use cases
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/residential-mobility.html">Residential mobility</a>
    </li>
    <li>
      <a href="../articles/mate-matching.html">Mate matching</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dymium-org/dymium">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="residential-mobility_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="residential-mobility_files/d3-3.3.8/d3.min.js"></script><script src="residential-mobility_files/dagre-0.4.0/dagre-d3.min.js"></script><link href="residential-mobility_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="residential-mobility_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="residential-mobility_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="residential-mobility_files/chromatography-0.1/chromatography.js"></script><script src="residential-mobility_files/DiagrammeR-binding-1.0.1/DiagrammeR.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Residential mobility</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dymium-org/dymium/blob/master/vignettes/residential-mobility.Rmd"><code>vignettes/residential-mobility.Rmd</code></a></small>
      <div class="hidden name"><code>residential-mobility.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dymium)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; + dymiumCore 0.0.10      Date: 2019-12-02</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt;                                   R: 3.6.1</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt;                                  OS: Ubuntu 16.04.6 LTS</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt;                                 GUI: X11</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;                                </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(data.table)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sf)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; Linking to GEOS 3.7.1, GDAL 2.2.2, PROJ 4.9.2</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(gganimate)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; Attaching package: 'gganimate'</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; The following object is masked from 'package:dymiumCore':</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt;     Transition</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DiagrammeR)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">728</span>)</a></code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Residential mobility or household relocation plays an important role in determining the urban traffic and the real estate market condition. In this example, we create a simple residential mobility model which comprises of two stages. The first stage is for households to decide whether to move from their current residence. If they decide to move then they will go onto the second stage otherwise they will remain where they are. The second stage is for the moving households to decide where they will relocate to.</p>
<div class="figure" style="text-align: center">
<div id="htmlwidget-985d8cbcdbe9419f04ec" style="width:100%;height:180px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-985d8cbcdbe9419f04ec">{"x":{"diagram":"\ngraph LR\n  Start((start))-->FirstStage{Relocate?}\n  FirstStage--Yes-->SecondStage{Where to?}\n  FirstStage--No-->NotMove[Remain in the residence]\n  SecondStage-->Move[Move to the new zone]\n  Move-->Stop((Stop))\n  NotMove-->Stop((Stop))\n  "},"evals":[],"jsHooks":[]}</script><p class="caption">
Flowchart of the processes in the simple residential mobility model
</p>
</div>
</div>
<div id="required-knowledge" class="section level2">
<h2 class="hasAnchor">
<a href="#required-knowledge" class="anchor"></a>Required knowledge</h2>
<p>This example requires the reader to know the grammar of data operations of the <code>data.table</code> package as it is quite different from the base R <code>data.frame</code> and also knows the <code>R6</code> package to fully utilise the base classes of <code>dymiumCore</code>.</p>
</div>
<div id="assumptions" class="section level2">
<h2 class="hasAnchor">
<a href="#assumptions" class="anchor"></a>Assumptions</h2>
<p>To make this model simple, the following assumptions were made.</p>
<ol style="list-style-type: decimal">
<li>All households have 5% chance to move within one year.</li>
<li>Moving households only consider the neighboring zones of their current zone.</li>
<li>Only interzone relocation is considered.</li>
</ol>
<p>Here is the map of all the zones in this example.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(toy_zones) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">fill =</span> albers_sqm)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf_label</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">label =</span> <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(toy_zones)))</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; give correct results for longitude/latitude data</span></a></code></pre></div>
<p><img src="residential-mobility_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Here is the list of queen contiguity of the zones.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">st_queen &lt;-<span class="st"> </span><span class="cf">function</span>(a, <span class="dt">b =</span> a) <span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_relate.html">st_relate</a></span>(a, b, <span class="dt">pattern =</span> <span class="st">"F***T****"</span>, <span class="dt">sparse =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">nb_list &lt;-<span class="st"> </span><span class="kw">st_queen</span>(toy_zones)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; although coordinates are longitude/latitude, st_relate_pattern assumes that they are planar</span></a></code></pre></div>
<p>Since <code>nb_list</code> refers to the zones by their row numbers as listed in the <code>toy_zones</code>, we need to replace those row numbers with their respective <code>zid</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># make the returned object from `st_queen` into a list by removing its class and attributes.</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(nb_list) &lt;-<span class="st"> </span><span class="ot">NULL</span> </a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span>(nb_list) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># name all elements in the list by their associated `zid`.</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(nb_list) &lt;-<span class="st"> </span>toy_zones<span class="op">$</span>zid</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co"># go inside each element of the list to replace row numbers with their `zid` in `toy_zones`.</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">nb_list &lt;-</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(nb_list, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">    <span class="kw"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(toy_zones<span class="op">$</span>zid[x])</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">  })</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">nb_list</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; $`206041117`</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; [1] 206041119 206041122 206041123 206041124</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; $`206041118`</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; [1] 206041122 206041123 206041126 206041127</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; $`206041119`</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; [1] 206041117 206041122 206041126</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; $`206041120`</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; [1] 206041121</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; $`206041121`</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt; [1] 206041120 206041123 206041127</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt; $`206041122`</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt; [1] 206041117 206041118 206041119 206041123 206041126</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt; $`206041123`</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt; [1] 206041117 206041118 206041121 206041122 206041124 206041127</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co">#&gt; $`206041124`</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">#&gt; [1] 206041117 206041123</span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="co">#&gt; $`206041125`</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="co">#&gt; [1] 206041126</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="co">#&gt; $`206041126`</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="co">#&gt; [1] 206041118 206041119 206041122 206041125</span></a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-42" data-line-number="42"><span class="co">#&gt; $`206041127`</span></a>
<a class="sourceLine" id="cb4-43" data-line-number="43"><span class="co">#&gt; [1] 206041118 206041121 206041123</span></a></code></pre></div>
</div>
<div id="create-a-microsimulation-model" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-microsimulation-model" class="anchor"></a>Create a microsimulation model</h2>
<div id="prepare-the-initial-state-of-the-world" class="section level3">
<h3 class="hasAnchor">
<a href="#prepare-the-initial-state-of-the-world" class="anchor"></a>Prepare the initial state of the world</h3>
<p>The provided toy datasets from the dymiumCore package are used in this example. We are going to create only Household agents.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">new_toy_households &lt;-<span class="st"> </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(toy_households, toy_dwellings[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"did"</span>, <span class="st">"zid"</span>)], <span class="dt">by =</span> <span class="st">"did"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># create a emptied World object to store agents and models</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">world &lt;-<span class="st"> </span>World<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">world<span class="op">$</span><span class="kw">add</span>(<span class="dt">x =</span> Household<span class="op">$</span><span class="kw">new</span>(new_toy_households, <span class="dt">id_col =</span> <span class="st">"hid"</span>), <span class="dt">name =</span> <span class="st">"Household"</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; [22:12:19] WARN  dymiumCore world$add: The given `name` will be ignored since the object in x is of a Dymium class object. The classname of the object will be used as its name.</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$add: Adding an Entity object 'Household' to Entities.</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># calling the `world` object</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">world</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; There are 1 items in self$Cont.</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; Class: Household</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  Inheritance: Household &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;  Number_of_entities: 144</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  Number_of_removed_entities: 0</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  Data[rows, cols]: attrs[144, 3]</span></a></code></pre></div>
<p>You can see that there is only one entity inside the world object which Household agents. The Household object contains attributes and methods of its agents and can be accessed by calling the <code><a href="https://rdrr.io/r/base/get.html">get()</a></code> method of <code>world</code></p>
<p>For example</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">world<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"Household"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; Class: Household</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;  Inheritance: Household &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;  Number_of_entities: 144</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt;  Number_of_removed_entities: 0</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;  Data[rows, cols]: attrs[144, 3]</span></a></code></pre></div>
<p>A reference to any objects in <code>world</code> can be created by assigning the result from <code>world$get()</code> to a variable.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">Hh &lt;-<span class="st"> </span>world<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"Household"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">Hh</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; Class: Household</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;  Inheritance: Household &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt;  Number_of_entities: 144</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;  Number_of_removed_entities: 0</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;  Data[rows, cols]: attrs[144, 3]</span></a></code></pre></div>
<p>To access the attributes of Individual agents you may use the <code>get_data()</code> method as following</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">Hh<span class="op">$</span><span class="kw">get_data</span>()</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt;      did hid       zid</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt;   1:   1   1 206041124</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;   2:   2   2 206041124</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;   3:   3   3 206041119</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt;   4:   4   4 206041125</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;   5:   5   5 206041123</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;  ---                  </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; 140: 140 140 206041127</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; 141: 141 141 206041119</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; 142: 142 142 206041125</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; 143: 143 143 206041126</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; 144: 144 144 206041127</span></a></code></pre></div>
</div>
<div id="prepare-models" class="section level3">
<h3 class="hasAnchor">
<a href="#prepare-models" class="anchor"></a>Prepare models</h3>
<p>First we need to create a list that contains the assumed transition probabilities.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">move_rate &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">yes =</span> <span class="fl">0.05</span>, <span class="dt">no =</span> <span class="fl">0.95</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">move_rate</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; $yes</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; [1] 0.05</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; $no</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; [1] 0.95</span></a></code></pre></div>
<p>As you can see, we have created a named list that contains two elements which are â€˜yesâ€™ and â€˜noâ€™ with numeric values that represent the associated probabilities to the actions. All households have 5% chance that they would move and 95% chance that they would remain where they are.</p>
<p>The next step is to store the <code>move_rate</code> model and the list that contains the indices of neighboring zones, <code>nb_list</code>, in side the <code>world</code> object as following.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">world<span class="op">$</span><span class="kw">add</span>(<span class="dt">x =</span> move_rate, <span class="dt">name =</span> <span class="st">"move_rate"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$add: Adding a Model object 'move_rate' to Models.</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">world<span class="op">$</span><span class="kw">add</span>(<span class="dt">x =</span> nb_list, <span class="dt">name =</span> <span class="st">"nb_zones"</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$add: Adding a Model object 'nb_zones' to Models.</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co"># it can be accessed using the get method as well. </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">world<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"move_rate"</span>)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; $yes</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; [1] 0.05</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; $no</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; [1] 0.95</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co"># the safer option is to use `get_model` method which only look for keys that contain model objects while the `get` method looks at all keys stored.</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co"># world$get_model("move_rate")</span></a></code></pre></div>
<p><code>TransitionClassification</code> allows a probabilistic model such as the one we have just created, <code>move_rate</code>, to be used for simulation (Monte Carlo).</p>
<p>The steps of the residential mobility event are inside the following function.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">event_ltmobility_residentialRelocation &lt;-<span class="st"> </span><span class="cf">function</span>(world) {</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="co"># Get the household object from `world`</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  Hh &lt;-<span class="st"> </span>world<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"Household"</span>)  </a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  <span class="co"># simulate the first stage - move or not move? ----</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  TransMove &lt;-<span class="st"> </span>TransitionClassification<span class="op">$</span><span class="kw">new</span>(<span class="dt">x =</span> Hh, <span class="dt">model =</span> world<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"move_rate"</span>)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>())</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb13-8" data-line-number="8">  <span class="co"># get_result returns a data.table with two columns `id` and `response`.</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">  moving_household_ids &lt;-<span class="st"> </span>TransMove<span class="op">$</span><span class="kw">get_result</span>()[response <span class="op">==</span><span class="st"> "yes"</span>, id]</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb13-11" data-line-number="11">  <span class="co"># simulate the second stage - where to? ----</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12">  <span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(moving_household_ids) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">    <span class="co"># create a choiceset for each moving household</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14">    <span class="co"># get only `hid` and `zid` of the moving households by creating a copy of </span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15">    <span class="co"># their attribute data.</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16">    mover_choicemodel &lt;-<span class="st"> </span>Hh<span class="op">$</span><span class="kw">get_data</span>(<span class="dt">ids =</span> moving_household_ids)[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hid"</span>, <span class="st">"zid"</span>)]</a>
<a class="sourceLine" id="cb13-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb13-18" data-line-number="18">    <span class="co"># create emptied columns to store choicesets and their probabilities</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19">    mover_choicemodel[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">choices =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(), <span class="dt">probs =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>())] </a>
<a class="sourceLine" id="cb13-20" data-line-number="20">    </a>
<a class="sourceLine" id="cb13-21" data-line-number="21">    <span class="co"># get the list of neighboring zones. Note that the second `$get()` is required </span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22">    <span class="co"># to get the list instead of not a model object. </span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23">    nb_zones &lt;-<span class="st"> </span>world<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"nb_zones"</span>)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>() </a>
<a class="sourceLine" id="cb13-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb13-25" data-line-number="25">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(mover_choicemodel)) {</a>
<a class="sourceLine" id="cb13-26" data-line-number="26">      self_zid &lt;-<span class="st"> </span>mover_choicemodel[i, zid] <span class="co"># get `zid` in row `i`</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27">      choices &lt;-<span class="st"> </span>nb_zones[[self_zid]] <span class="co"># get the neighboring zones</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28">      probs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dt">x =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(choices), <span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(choices)) <span class="co"># assign equal probabilities to all choices</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29">      <span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/assign.html">set</a></span>(mover_choicemodel, <span class="dt">i =</span> i, <span class="dt">j =</span> <span class="st">"choices"</span>, <span class="dt">value =</span> choices)</a>
<a class="sourceLine" id="cb13-30" data-line-number="30">      <span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/assign.html">set</a></span>(mover_choicemodel, <span class="dt">i =</span> i, <span class="dt">j =</span> <span class="st">"probs"</span>, <span class="dt">value =</span> probs) </a>
<a class="sourceLine" id="cb13-31" data-line-number="31">    }</a>
<a class="sourceLine" id="cb13-32" data-line-number="32">    </a>
<a class="sourceLine" id="cb13-33" data-line-number="33">    <span class="co"># remove `zid` since the TransitionClassification assumes that all columns that </span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34">    <span class="co"># are not named as `probs` and `choices` are supposed to be used as matching columns  </span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35">    mover_choicemodel[, zid <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a>
<a class="sourceLine" id="cb13-36" data-line-number="36">    </a>
<a class="sourceLine" id="cb13-37" data-line-number="37">    <span class="co"># simulate location selection</span></a>
<a class="sourceLine" id="cb13-38" data-line-number="38">    TransWhereTo &lt;-<span class="st"> </span>TransitionClassification<span class="op">$</span><span class="kw">new</span>(</a>
<a class="sourceLine" id="cb13-39" data-line-number="39">      <span class="dt">x =</span> Hh,</a>
<a class="sourceLine" id="cb13-40" data-line-number="40">      <span class="dt">model =</span> mover_choicemodel,</a>
<a class="sourceLine" id="cb13-41" data-line-number="41">      <span class="dt">targeted_agents =</span> mover_choicemodel[, hid],</a>
<a class="sourceLine" id="cb13-42" data-line-number="42">      <span class="dt">model_by_id =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb13-43" data-line-number="43">    )<span class="op">$</span><span class="kw">update_agents</span>(<span class="dt">attr =</span> <span class="st">"zid"</span>)</a>
<a class="sourceLine" id="cb13-44" data-line-number="44">  }</a>
<a class="sourceLine" id="cb13-45" data-line-number="45">  </a>
<a class="sourceLine" id="cb13-46" data-line-number="46">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(world)</a>
<a class="sourceLine" id="cb13-47" data-line-number="47">}</a></code></pre></div>
</div>
<div id="create-a-microsimulation-pipeline" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-microsimulation-pipeline" class="anchor"></a>Create a microsimulation pipeline</h3>
<p>To simulate the residential mobility event for multiple iterations we can simply use a flow control statement such as a â€˜forâ€™ loop. The below chunk of codes run the residential mobility event that we have just created for 10 iterations and at the end of each iteration the total number of households in each zone will be stored inside <code>count_ls</code> which will be indexed by the iteration number.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">start_iter &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">end_iter &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">count_ls &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>() </a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> start_iter<span class="op">:</span>end_iter) {</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  world<span class="op">$</span><span class="kw">start_iter</span>(i, <span class="dt">unit =</span> <span class="st">"year"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="st">    </span><span class="kw">event_ltmobility_residentialRelocation</span>(.)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb14-8" data-line-number="8">  <span class="co"># record the count of households by zone in each iteration</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9">  count_ls[[i]] &lt;-</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="st">    </span>world<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"Household"</span>)<span class="op">$</span><span class="kw">get_data</span>()[, .(<span class="dt">count =</span> .N, <span class="dt">iteration =</span> i), by =<span class="st"> </span>zid]</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 1</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 2</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 3</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 4</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 5</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 6</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 7</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 8</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 9</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt; [22:12:19] INFO  dymiumCore world$start_iter: Starting year: 10</span></a></code></pre></div>
</div>
</div>
<div id="visualise-the-result" class="section level2">
<h2 class="hasAnchor">
<a href="#visualise-the-result" class="anchor"></a>Visualise the result</h2>
<p>To visualise the spatial dynamic of households we use the <code>gganimate</code> and <code>ggplot</code> packages.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">count &lt;-<span class="st"> </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbindlist</a></span>(count_ls)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">count &lt;-<span class="st"> </span><span class="kw"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(count, toy_zones, <span class="dt">by =</span> <span class="st">"zid"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>()</a></code></pre></div>
<p>As a spatial plot..</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">anim &lt;-</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(count) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">fill =</span> count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf_label</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">label =</span> sa2_name11)) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="st">  </span><span class="co"># Here come the gganimate specific bits</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">title =</span> <span class="st">"Spatial distribution of households"</span>, </a>
<a class="sourceLine" id="cb16-7" data-line-number="7">       <span class="dt">subtitle =</span> <span class="st">"Iteration: {frame_time}"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>(<span class="dt">option =</span> <span class="st">"B"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(iteration)</a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="kw"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(anim, <span class="dt">width =</span> <span class="dv">800</span>, <span class="dt">height =</span> <span class="dv">800</span>, <span class="dt">res =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22"></a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25"></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"></a>
<a class="sourceLine" id="cb16-29" data-line-number="29"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-31" data-line-number="31"></a>
<a class="sourceLine" id="cb16-32" data-line-number="32"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-33" data-line-number="33"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-34" data-line-number="34"></a>
<a class="sourceLine" id="cb16-35" data-line-number="35"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-36" data-line-number="36"><span class="co">#&gt; give correct results for longitude/latitude data</span></a>
<a class="sourceLine" id="cb16-37" data-line-number="37"></a>
<a class="sourceLine" id="cb16-38" data-line-number="38"><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></a>
<a class="sourceLine" id="cb16-39" data-line-number="39"><span class="co">#&gt; give correct results for longitude/latitude data</span></a></code></pre></div>
<p><img src="residential-mobility_files/figure-html/unnamed-chunk-17-1.gif" width="100%" style="display: block; margin: auto;"></p>
<!-- ```{r gapgif, fig.show='animate', ffmpeg.format='gif', dev='jpeg', fig.asp = 1, fig.align = "center", fig.width =  7, message=FALSE, warning=FALSE} -->
<!-- plots <- purrr::map(1:10, ~ { -->
<!--   ggplot(subset(count, iteration == .x)) + -->
<!--     geom_sf(aes(fill = count)) + -->
<!--     geom_sf_label(aes(label = sa2_name11)) + -->
<!--     # Here come the gganimate specific bits -->
<!--     scale_fill_viridis_c(option = "B", limits = c(0,28)) + -->
<!--     labs(title = "Spatial distribution of households",  -->
<!--          subtitle = paste0("Iteration: ", .x)) -->
<!-- }) -->
<!-- purrr::walk(plots, print) -->
<!-- ``` -->
<p>As a time series plot..</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">anim &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(count, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(iteration, count, <span class="dt">group =</span> sa2_name11)) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">xend =</span> <span class="dv">10</span>, <span class="dt">yend =</span> count), <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">'grey'</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> <span class="fl">10.1</span>, <span class="dt">label =</span> sa2_name11), <span class="dt">hjust =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span>(<span class="dt">clip =</span> <span class="st">'off'</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal</a></span>(iteration) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">title =</span> <span class="st">"Counts of households by zones"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">plot.margin =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span>(<span class="fl">5.5</span>, <span class="dv">40</span>, <span class="fl">5.5</span>, <span class="fl">5.5</span>))</a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="kw"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(anim, <span class="dt">width =</span> <span class="dv">800</span>, <span class="dt">height =</span> <span class="dv">600</span>, <span class="dt">res =</span> <span class="dv">100</span>)</a></code></pre></div>
<p><img src="residential-mobility_files/figure-html/unnamed-chunk-18-1.gif" width="100%" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#required-knowledge">Required knowledge</a></li>
      <li><a href="#assumptions">Assumptions</a></li>
      <li>
<a href="#create-a-microsimulation-model">Create a microsimulation model</a><ul class="nav nav-pills nav-stacked">
<li><a href="#prepare-the-initial-state-of-the-world">Prepare the initial state of the world</a></li>
      <li><a href="#prepare-models">Prepare models</a></li>
      <li><a href="#create-a-microsimulation-pipeline">Create a microsimulation pipeline</a></li>
      </ul>
</li>
      <li><a href="#visualise-the-result">Visualise the result</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Amarin Siripanich, Taha Rashidi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
